import{a as x,j as e}from"./react-CfHc84lV.js";import{c as P}from"./react-dom-CLMrTVao.js";import{B as y,F as D,a as I,b as M}from"./react-icons-CcDZQb86.js";import{P as T}from"./pizzip-CSmpHWbA.js";import{D as O}from"./docxtemplater-Cx2gcKov.js";import{r as _,u as C}from"./xlsx-B4JKliiB.js";import{r as B}from"./docx-preview-BjRdcLm-.js";import{J as R}from"./jszip-CuQb68Cf.js";import"./@xmldom-DOVMbaKB.js";import"./scheduler-SPyfQU6S.js";import"./pako-BxtY3PN3.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function r(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=r(a);fetch(a.href,o)}})();const X="data:image/svg+xml,%3csvg%20width='241'%20height='241'%20xmlns='http://www.w3.org/2000/svg'%20version='1.1'%20enable-background='new%200%200%201024%201024'%20xml:space='preserve'%3e%3cg%3e%3ctitle%3eLayer%201%3c/title%3e%3crect%20stroke-width='0'%20rx='100'%20stroke='null'%20x='0'%20y='0'%20width='241'%20height='241'%20fill='black'%20id='svg_1'/%3e%3cg%20id='svg_4'%3e%3cpath%20fill='%23ffffff'%20d='m118.55069,149.33715c-14.62097,11.3237%20-28.96093,22.42761%20-43.33288,33.48987c-12.88043,9.91421%20-31.13303,7.4787%20-40.88532,-5.40995c-9.36813,-12.38083%20-6.12231,-30.52478%206.65137,-40.28094c33.71466,-25.75031%2067.38696,-51.56024%20100.80127,-77.69782c18.04852,-14.11804%2042.49353,-7.17434%2047.62549,14.33823c2.73572,11.46805%20-0.38165,21.51025%20-9.96216,28.89752c-20.15778,15.54303%20-40.41455,30.95777%20-60.89777,46.66309z'%20id='svg_2'/%3e%3cpath%20fill='%23ff7f00'%20d='m148.34928,188.73757c-17.04663,-5.35175%20-22.70111,-22.88468%20-11.74958,-35.60675c3.81959,-4.43707%208.7425,-6.99866%2014.80225,-6.99698c13.48694,0.00369%2026.97577,-0.19424%2040.46015,-0.02252c11.52081,0.1467%2020.35644,9.80755%2020.19116,21.61932c-0.15997,11.42722%20-9.27039,21.00876%20-20.34046,21.09076c-14.31756,0.10611%20-28.63671,-0.00421%20-43.36352,-0.08383z'%20id='svg_3'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",G=()=>{const[s,t]=x.useState(!1);return e.jsxs("nav",{className:"bg-bk-2 border-b border-bk-3 text-wt-1","aria-label":"Barra de navegação principal",children:[e.jsxs("div",{className:"max-w-6xl mx-auto px-4 py-4 flex items-center justify-between",children:[e.jsx(H,{}),e.jsx(U,{menuOpen:s,setMenuOpen:t}),e.jsx(z,{className:"hidden md:flex gap-6"})]}),s&&e.jsx(z,{className:"md:hidden px-4 pb-4 space-y-2"})]})},H=()=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden flex items-center justify-center text-bk-1 font-bold text-lg select-none",children:e.jsx("img",{src:X,alt:"Logo",className:"w-full h-full object-cover"})}),e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gradient-orange",children:"Mala direta"})]}),z=({className:s=""})=>e.jsxs("ul",{className:`${s} text-gr-2 font-medium`,role:"menu",children:[e.jsx("li",{className:"hover:text-or-1 cursor-pointer",children:"Início"}),e.jsx("li",{className:"hover:text-or-1 cursor-pointer",children:"Funcionalidades"}),e.jsx("li",{className:"hover:text-or-1 cursor-pointer",children:"Sobre"})]}),U=({menuOpen:s,setMenuOpen:t})=>e.jsx("button",{onClick:()=>t(!s),className:"md:hidden focus:outline-none focus:ring-2 focus:ring-or-2","aria-label":s?"Fechar menu":"Abrir menu",children:e.jsx("svg",{className:"w-6 h-6 text-wt-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:s?"M6 18L18 6M6 6l12 12":"M4 6h16M4 12h16M4 18h16"})})}),S=({children:s})=>e.jsx("div",{className:`
        flex bg-bk-2 rounded-xl border border-bk-3 shadow-lg py-8 px-4 max-w-2xl w-full lg:h-[80svh]
        `,children:s}),q=[{id:1,text:"Importe um modelo .docx com tags como: {nome} {sobrenome} {data}."},{id:2,text:"Envie uma planilha .xlsx com colunas correspondentes às tags."},{id:3,text:"Escolha qual coluna será usada para nomear os arquivos."},{id:4,text:"Confira a prévia e gere os documentos personalizados."}],K=()=>{const[s,t]=x.useState(0),r=a=>{t(a)},l=()=>{switch(s){case 0:return e.jsx(Z,{});case 1:return e.jsx(W,{});case 2:return e.jsx(J,{});case 3:return e.jsx(V,{});default:return null}};return e.jsxs("div",{className:"flex flex-col justify-start gap-8 w-full items-center h-auto px-4",role:"region","aria-label":"Instruções do aplicativo",children:[e.jsx("h2",{className:"text-gradient-orange text-2xl font-bold text-center",children:"como funciona"}),e.jsx("div",{className:"flex gap-4 w-full justify-center",role:"tablist",children:q.map((a,o)=>e.jsx("button",{onClick:()=>r(o),"aria-label":`Ir para o passo ${a.id}: ${a.text}`,"aria-current":s===o?"step":void 0,className:`h-10 w-10 flex items-center justify-center rounded-full transition font-bold text-base border cursor-pointer
              ${s===o?"bg-gradient-to-r from-or-1 to-or-3 text-wt-1 border-transparent":"bg-gr-3 text-gr-1 border-gr-2 hover:bg-gr-2 hover:text-wt-2"}`,children:a.id},a.id))}),e.jsx("p",{className:"text-gr-2 leading-relaxed text-center max-w-md",children:q[s].text}),l()]})},Z=()=>e.jsxs("article",{className:"h-[80mm] w-[50mm] bg-wt-2 rounded-xl text-gr-3 text-sm p-4 leading-relaxed flex flex-col justify-between shadow-lg",children:[e.jsx("p",{children:"Prezado sr(a)."}),e.jsx("p",{children:e.jsx("strong",{children:"{nome} {sobrenome}"})}),e.jsx("p",{children:"Lorem ipsum dolor sit amet consectetur adipisicing elit."}),e.jsx("p",{children:"Hic quas assumenda provident totam!"}),e.jsx("p",{children:e.jsx("strong",{children:"{data}"})})]}),W=()=>{const s=["nome","sobrenome","data"],t=[{nome:"Ana",sobrenome:"Silva",data:"2025-01-10"},{nome:"Bruno",sobrenome:"Souza",data:"2025-02-14"},{nome:"Carlos",sobrenome:"Pereira",data:"2025-03-21"},{nome:"Daniela",sobrenome:"Oliveira",data:"2025-04-08"},{nome:"Eduardo",sobrenome:"Lima",data:"2025-05-17"}];return e.jsxs("table",{className:"w-full bg-wt-2 rounded-xl border-gray-300 text-left text-xs table-fixed overflow-hidden text-gr-3 shadow-2xl",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-wt-3",children:s.map(r=>e.jsx("th",{className:"border border-gray-300 px-2 py-1",children:r},r))})}),e.jsx("tbody",{children:t.map((r,l)=>e.jsx("tr",{className:"hover:bg-gray-50",children:s.map(a=>e.jsx("td",{className:"border border-gray-300 px-2 py-1",children:r[a.toLowerCase()]},a))},l))})]})},J=()=>e.jsxs("div",{className:"flex flex-col gap-4 items-center",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{className:"bg-or-3 text-wt-1 font-bold px-4 py-2 rounded",children:"nome"}),e.jsx("button",{className:"bg-or-2 opacity-50 text-wt-1 font-bold px-4 py-2 rounded",children:"sobrenome"}),e.jsx("button",{className:"bg-or-2 opacity-50 text-wt-1 font-bold px-4 py-2 rounded",children:"data"})]}),e.jsx("p",{className:"text-sm text-gr-2 mt-4 text-center ",children:"Os Arquivos serão nomeados correspondente à coluna escolhida:"}),e.jsxs("ul",{children:[e.jsxs("li",{className:"flex gap-2 items-center underline",children:[e.jsx(y,{}),e.jsx("em",{children:"Ana.docx"})]}),e.jsxs("li",{className:"flex gap-2 items-center underline",children:[e.jsx(y,{}),e.jsx("em",{children:"Bruno.docx"})]}),e.jsxs("li",{className:"flex gap-2 items-center underline",children:[e.jsx(y,{}),e.jsx("em",{children:"Carlos.docx"})]}),e.jsxs("li",{className:"flex gap-2 items-center underline",children:[e.jsx(y,{}),e.jsx("em",{children:"Daniela.docx"})]}),e.jsxs("li",{className:"flex gap-2 items-center underline",children:[e.jsx(y,{}),e.jsx("em",{children:"Eduardo.docx"})]})]})]}),V=()=>e.jsxs("article",{className:"h-[80mm] w-[50mm] bg-wt-2 rounded-xl text-gr-3 text-sm p-4 leading-relaxed flex flex-col justify-between shadow-lg",children:[e.jsx("p",{children:"Prezado sr(a)."}),e.jsx("p",{children:e.jsx("strong",{children:"Bruno Souza"})}),e.jsx("p",{children:"Lorem ipsum dolor sit amet consectetur adipisicing elit."}),e.jsx("p",{children:"Hic quas assumenda provident totam!"}),e.jsx("p",{children:e.jsx("strong",{children:"2525-02-14"})})]}),F=x.createContext(),L=()=>{const s=x.useContext(F);if(!s)throw new Error("useLogger deve ser usado dentro de um LoggerProvider");return s},Q=()=>{const{logs:s}=L(),t=r=>{switch(r){case"success":return"text-green-400";case"warning":return"text-yellow-400";case"error":return"text-red-400";case"info":default:return"text-grey-200"}};return e.jsxs("div",{className:"flex flex-col justify-start gap-8 w-full items-center h-auto px-4",role:"region","aria-label":"Instruções do aplicativo",children:[e.jsx("h2",{className:"text-gradient-orange text-2xl font-bold text-center",children:"logs"}),e.jsx("div",{className:` 
          flex flex-col overflow-y-auto lg:h-full w-full
          bg-bk-3 rounded-lg p-4 text-gr-2
          `,tabIndex:0,"aria-live":"polite",children:s.length===0?e.jsx("p",{children:"Nenhuma ação realizada ainda."}):s.slice().reverse().map((r,l)=>e.jsx("p",{className:`mb-2 ${t(r.status)}`,dangerouslySetInnerHTML:{__html:`[${r.timestamp}] ${r.message.replace(/\n/g,"<br />")}`}},l))})]})},A=(s,t)=>{if(!s||!s.name)return!1;const r=s.name.toLowerCase(),l=t.toLowerCase();return r.endsWith(l)},Y=async(s,t)=>{try{const r=await s.arrayBuffer();if(r.byteLength===0)return{status:"nok",message:"O arquivo está vazio.",buffer:null};const l=r.byteLength/(1024*1024);return l>t?{status:"nok",message:`O arquivo é muito grande (${l.toFixed(2)}MB). Máximo permitido: ${t}MB.`,buffer:null}:{status:"ok",buffer:r}}catch(r){return{status:"nok",message:`Erro ao ler o arquivo: ${r.message||r}`,buffer:null}}},ee=s=>{try{return{status:"ok",zip:new T(s)}}catch(t){return{status:"nok",message:`Erro ao processar o arquivo ZIP: ${t.message||t}`,zip:null}}},se=s=>s==null?"":(s=String(s).trim(),s=s.replace(/\t+/g," "),s=s.replace(/[\r\n]+/g," "),s=Array.from(s).filter(r=>r.charCodeAt(0)>31).join(""),["​","‌","‍","\uFEFF"," "," "].forEach(r=>{s=s.split(r).join("")}),s=s.replace(/\s+/g," "),s.length===0||s===" "?"":s),te=s=>s.map((t,r)=>{const l=se(t);return t!==l?{index:r,original:t,sanitized:l}:null}).filter(t=>t!==null),E=(()=>{const s=a=>{var o,c,i,d;try{return{status:"ok",docx:new O(a,{paragraphLoop:!0,linebreaks:!0,nullGetter:()=>""})}}catch(n){const f=["duplicate_open_tag","duplicate_close_tag"];return{status:"nok",docx:null,message:(Array.isArray((o=n==null?void 0:n.properties)==null?void 0:o.errors)?n.properties.errors:[]).filter(g=>{var h;return f.includes((h=g==null?void 0:g.properties)==null?void 0:h.id)}).length>0?"Foram encontradas tags com chaves duplas {{tag}}. Use apenas uma chave: {tag}.":`Erro ao inicializar o Docxtemplater: ${((d=(i=(c=n==null?void 0:n.properties)==null?void 0:c.errors)==null?void 0:i[0])==null?void 0:d.message)||n.message||n}`}}},t=async a=>{const o=await Y(a,5);if(o.status==="nok")return{status:"nok",message:o.message,docx:null};const c=ee(o.buffer);if(c.status==="nok")return{status:"nok",message:c.message,docx:null};const i=s(c.zip);return i.status==="nok"?{status:"nok",message:i.message,docx:null}:{status:"ok",docx:i.docx,message:"Arquivo processado com sucesso."}};return{getTags:async a=>{const{status:o,docx:c,message:i}=await t(a);if(o==="nok")return{status:o,tags:null,blob:null,message:i};try{const d=c.getFullText();if(!d)return{status:"nok",tags:null,blob:null,message:"O documento está vazio."};const n=/{([^{}]+)}/g,f=[...d.matchAll(n)],p=[...new Set(f.map(u=>u[1]))];return p.length===0?{status:"nok",tags:null,blob:null,message:"Nenhuma tag foi encontrada no documento."}:{status:"ok",tags:p,message:`${p.length} tag(s) identificada(s) com sucesso.`}}catch(d){return{status:"nok",tags:null,blob:null,message:`Erro ao tentar extrair tags do documento: ${d.message||d}`}}},replaceTags:async(a,o)=>{const{status:c,docx:i,message:d}=await t(a);if(c==="nok")return{status:c,tags:null,blob:null,message:d};try{return i.render(o),{status:"ok",blob:i.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",compression:"DEFLATE",compressionOptions:{level:6}}),message:"Tags substituídas com sucesso no documento."}}catch(n){return{status:"nok",tags:null,blob:null,message:`Erro ao renderizar o documento: ${(Array.isArray(n==null?void 0:n.errors)?n.errors.map(p=>{var u;return((u=p.properties)==null?void 0:u.explanation)||p.message}):[n.message||n]).join(" | ")}`}}}}})(),$=x.createContext({}),k=()=>x.useContext($),re=({setStep:s})=>{const{log:t}=L(),{files:r,setFiles:l}=k(),[a,o]=x.useState(!1),[c,i]=x.useState([]),[d,n]=x.useState(null),f=async p=>{const u=p.target.files[0];if(!A(u,"docx")){t("error","Arquivo inexistente ou inválido.");return}o(!0);try{const{tags:m,status:g,message:h}=await E.getTags(u);if(g==="nok"){t("error",h);return}const v=te(m);if(i(m),v.length>0){const b=v.map(w=>`{${w.original}} → {${w.sanitized}}`).join(`
`);n(b),t("warning",`Foram encontradas tags com espaços desnecessários.
          Substituições sugeridas:
          ${b}`);return}l({...r,docx:{file:u,tags:m}}),t("info",`${h}
${m.join(" | ")}`),t("success",`Arquivo ${u.name} processado com sucesso.`),s("xlsx")}catch(m){t("error","Erro ao processar o arquivo .docx."),console.error(m)}finally{o(!1)}};return e.jsxs("div",{className:"flex flex-col justify-start gap-6 w-full items-center px-4",children:[e.jsx("h2",{className:"text-gradient-orange text-2xl font-bold text-center",children:"Importe o modelo DOCX"}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("label",{htmlFor:"inputFile",tabIndex:0,className:`
            flex flex-col p-6 rounded items-center gap-4
            border-4 border-dashed border-of-blue-2
            cursor-pointer focus:outline-none focus:ring-2 focus:ring-of-blue-2
            transition-all duration-150
          `,children:[e.jsx("p",{className:"font-semibold",children:"Arquivo modelo (.docx)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Arraste ou clique para enviar"}),e.jsx(D,{className:"text-of-blue-2 size-8"})]}),e.jsx("input",{id:"inputFile",type:"file",accept:".docx",className:"hidden",onChange:f})]}),a&&e.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Processando arquivo..."}),c.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 border rounded w-full max-w-md",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Tags encontradas:"}),e.jsx("p",{className:"text-xs text-gray-700 break-words",children:c.join(" | ")})]}),d&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 w-full max-w-md",children:[e.jsx("h3",{className:"font-semibold text-sm text-yellow-700 mb-2",children:"Tags com espaços desnecessários detectadas"}),e.jsx("pre",{className:"text-xs text-yellow-800 whitespace-pre-wrap",children:d})]})]})},oe={readerXLSX:async t=>{try{const r=await t.arrayBuffer(),l=_(r,{type:"array"}),a=l.SheetNames[0],o=l.Sheets[a],c=l.SheetNames.length,i=C.sheet_to_json(o,{header:1,blankrows:!1});if(i.length===0)return{status:"nok",message:"Planilha não contém dados."};const d=i[0];if(d.length===0)return{status:"nok",message:"Planilha não tem cabeçalho."};const n=C.sheet_to_json(o,{blankrows:!1});if(n.length===0)return{status:"nok",message:"Planilha contém cabeçalho porém não tem dados."};if((()=>{const u=new Set;return n.forEach(m=>{Object.keys(m).forEach(g=>{d.includes(g)||u.add(g)})}),u.size>0})())return{status:"nok",message:"Foram encontrados dados em colunas sem cabeçalho."};const p=(()=>{const u=d.reduce((g,h)=>(g[h]={values:new Set,hasEmpty:!1},g),{});return n.forEach(g=>{d.forEach(h=>{const v=g[h];v==null||v===""?u[h].hasEmpty=!0:u[h].values.add(String(v))})}),d.filter(g=>!u[g].hasEmpty&&u[g].values.size===n.length)})();return p.length===0?{status:"nok",message:"Nenhuma das colunas possui dados únicos para ser usada como nome de arquivos."}:{status:"ok",message:"Arquivo processado com sucesso",sheets:c,headers:d,data:n,keys:p}}catch(r){return{status:"nok",message:`Erro aoprocessar arquivo. ${r}`}}}},ae=({setStep:s})=>{const{log:t}=L(),{files:r,setFiles:l}=k(),[a,o]=x.useState(!1),[c,i]=x.useState([]),d=async n=>{const f=n.target.files[0];if(!A(f,"xlsx")){t("error","Arquivo inexistente ou inválido.");return}o(!0);try{const p=await oe.readerXLSX(f),{status:u,headers:m,message:g,data:h}=p;if(u==="nok"){t("error",g);return}t("info",`Tags encontradas: ${m.join(" | ")}`),t("success",g),r.xlsx=p;const v=await E.replaceTags(r.docx.file,h[0]);r.preview=v.blob,i(m),l(r),s("files")}catch(p){t("error","Erro ao processar o arquivo."),console.error(p)}finally{o(!1)}};return e.jsxs("div",{className:"flex flex-col justify-start gap-6 w-full items-center px-4",children:[e.jsx("h2",{className:"text-gradient-orange text-2xl font-bold text-center",children:"Importe o modelo XLSX"}),e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("label",{htmlFor:"inputFile",tabIndex:0,className:`
            flex flex-col p-6 rounded items-center gap-4
            border-4 border-dashed border-of-green-3
            cursor-pointer focus:outline-none focus:ring-2 focus:ring-of-green-3
            transition-all duration-150
          `,children:[e.jsx("p",{className:"font-semibold",children:"Arquivo modelo (.xlsx)"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Arraste ou clique para enviar"}),e.jsx(I,{className:"text-of-green-3 size-8"})]}),e.jsx("input",{id:"inputFile",type:"file",accept:".xlsx",className:"hidden",onChange:d})]}),a&&e.jsx("p",{className:"text-sm text-gray-500 animate-pulse",children:"Processando arquivo..."}),c.length>0&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 border rounded w-full max-w-md",children:[e.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Tags encontradas:"}),e.jsx("p",{className:"text-xs text-gray-700 break-words",children:c.join(" | ")})]})]})},ne=({title:s})=>{const[t,r]=x.useState(!1),l=x.useRef(null),{files:a}=k(),o=a==null?void 0:a.preview,c=()=>r(!0),i=()=>r(!1);return x.useEffect(()=>{const d=n=>{n.key==="Escape"&&i()};return t&&window.addEventListener("keydown",d),()=>{window.removeEventListener("keydown",d)}},[t]),x.useEffect(()=>{if(t&&o&&l.current){l.current.innerHTML="";const d={className:"custom-docx",inWrapper:!1};B(o,l.current,null,d).catch(n=>{console.error("Error rendering DOCX:",n),l.current.innerHTML='<p class="text-red-500">Erro ao carregar o preview do documento.</p>'})}},[t,o]),e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:c,disabled:!o,className:`group flex items-center gap-2 px-4 py-2 rounded border border-or-3 transition 
    ${o?"hover:bg-or-3 hover:text-wt-1 cursor-pointer":"opacity-40 cursor-not-allowed"}
  `,"aria-label":"Abrir pré-visualização do documento",children:[e.jsx(y,{className:"text-or-2 group-hover:text-wt-1",size:18}),e.jsx("span",{className:"text-sm underline group-hover:no-underline",children:`${s}.docx`})]}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 bg-black overflow-auto",children:[e.jsx("button",{onClick:i,className:"fixed top-0 right-4 text-wt-3 hover:text-wt-1 text-6xl cursor-pointer","aria-label":"Fechar",children:"×"}),e.jsxs("div",{className:"w-full text-center flex flex-col items-center space-y-4 py-6 shadow-sm",children:[e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("h3",{className:"text-lg font-semibold text-gr-1",children:"Pré-visualização do Documento"})}),e.jsxs("p",{className:"text-sm text-gr-2 max-w-md",children:["Esta é apenas uma prévia para fins de revisão.",e.jsx("br",{}),"Pode conter pequenas divergências visuais que não estarão presentes no documento final."]})]}),e.jsx("div",{className:"flex justify-center pb-12 pt-4 relative",children:e.jsx("div",{ref:l,className:" bg-white rounded-lg shadow-lg overflow-auto",style:{overflow:"hidden",padding:0,textAlign:"initial"},children:!o&&e.jsx("p",{className:"text-bk-1",children:"Nenhum documento carregado para visualização."})})})]})]})},le=async(s,t,r,l,a)=>{const o=new R;try{for(let i=0;i<s.length;i++){const d=s[i],n=await E.replaceTags(t,d);if(n.status==="ok"&&n.blob){const f=`${r}_${d[r]}.docx`;o.file(f,n.blob)}else console.warn(`Erro ao processar ${d[r]}:`,n.message);l&&l({current:i+1,total:s.length})}return a&&a(),{status:"ok",message:"success",zip:await o.generateAsync({type:"blob"})}}catch(c){return console.error("Erro ao gerar os arquivos:",c),{status:"nok",message:`Erro ao gerar os arquivos: ${c.message}`,zip:null}}},ce=()=>{const{files:s}=k(),{data:t,keys:r}=s.xlsx,[l,a]=x.useState(),[o,c]=x.useState(null),[i,d]=x.useState(!1),[n,f]=x.useState({current:0,total:0}),[p,u]=x.useState(""),m=x.useRef(null),g=j=>{c(j),a(`${j}_${t[0][j]}`),f({current:0,total:0}),u("")},h=async()=>{d(!0),f({current:0,total:t.length}),u("Processando arquivos...");const j=()=>{let b=0;u("Compactando arquivos"),m.current=setInterval(()=>{b=(b+1)%4,u("Compactando arquivos"+".".repeat(b))},2e3)};try{const b=await le(t,s.docx.file,o,w=>{f(w)},()=>{j(),f({current:t.length,total:t.length})});if(m.current&&(clearInterval(m.current),m.current=null),b.status==="ok"){u("Download pronto!");const w=URL.createObjectURL(b.zip),N=document.createElement("a");N.href=w,N.download="mala-direta.zip",document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(w)}else alert(b.message),u("")}catch(b){alert("Erro ao gerar os arquivos."),console.error(b),u("")}finally{d(!1),f({current:0,total:0}),m.current&&(clearInterval(m.current),m.current=null)}},v=n.total>0?Math.round(n.current/n.total*100):0;return e.jsxs("div",{className:"flex flex-col justify-start gap-6 w-full items-center px-4 text-wt-1",role:"region","aria-label":"Gerador de Arquivo",children:[e.jsx("h2",{className:"text-or-1 text-2xl font-bold text-center",children:"Gerar arquivos DOCX"}),e.jsxs("div",{className:"w-full max-w-3xl flex flex-col gap-8",children:[e.jsxs("div",{className:"overflow-auto max-h-[300px] custom-scrollbar",children:[e.jsx("h3",{className:"text-center text-gr-2 mb-6",children:"Escolha a coluna para nomear os arquivos:"}),e.jsx("div",{className:"grid sm:grid-cols-2 md:grid-cols-3 gap-4",children:r.map(j=>{const b=o===j;return e.jsx("button",{onClick:()=>g(j),className:`w-full px-4 py-2 rounded font-semibold transition-all focus:outline-none focus-visible:ring-2 
                    ${b?"bg-or-2 ring-or-1 text-wt-1 scale-105 shadow-md":"bg-or-3 hover:bg-or-3 opacity-40 text-wt-1 hover:scale-105 hover:shadow-sm"}`,"aria-label":`Usar chave ${j} para nome do arquivo`,children:j},j)})})]}),l&&e.jsxs("div",{className:"flex flex-col gap-6 border-t border-gr-2 pt-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row w-full gap-4 justify-center items-stretch sm:items-center",children:[e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsx(ne,{title:"preview"})}),e.jsx("div",{className:"flex-1 flex justify-center",children:e.jsxs("button",{className:"w-full sm:w-auto bg-or-3 text-wt-1 font-bold px-6 py-2 rounded hover:bg-or-2 transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-or-1 truncate flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Baixar mala direta em arquivo zip",onClick:h,disabled:i,children:[e.jsx(M,{size:18}),e.jsx("span",{className:"truncate",children:i?"Gerando arquivos...":"gerar arquivos"})]})})]}),e.jsx("div",{className:"border-t border-gr-2"}),i&&n.total>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full bg-gray-300 rounded h-3 overflow-hidden mt-2",children:e.jsx("div",{className:"bg-or-2 h-3 transition-all duration-300",style:{width:`${v}%`}})}),e.jsxs("div",{className:"text-center mt-2 text-gr-2 font-medium",children:[p," (",n.current," de ",n.total,")"]})]})]})]})]})},ie=()=>{const[s,t]=x.useState("docx");return e.jsxs("main",{className:"h-[100svh] bg-bk-1 text-wt-1 font-sans flex flex-col",children:[e.jsx(G,{}),e.jsxs("section",{className:`h-[100%] overflow-y-auto overflow-x-hidden
          grid gap-4 p-4
          justify-center items-center
          lg:grid-cols-3
        `,children:[e.jsx(S,{children:e.jsx(K,{})}),e.jsxs(S,{children:[s==="docx"&&e.jsx(re,{setStep:t}),s==="xlsx"&&e.jsx(ae,{setStep:t}),s==="files"&&e.jsx(ce,{setStep:t})]}),e.jsx(S,{children:e.jsx(Q,{})})]})]})},de=({children:s})=>{const t=(c,i)=>{switch(i.type){case"ADD_LOG":return[...c,i.payload];case"CLEAR_LOGS":return[];default:return c}},[r,l]=x.useReducer(t,[]),a=(c,i)=>{const n={status:(c||"info").toString().toLowerCase(),message:i,timestamp:new Date().toLocaleTimeString()};l({type:"ADD_LOG",payload:n})},o=()=>{l({type:"CLEAR_LOGS"})};return e.jsx(F.Provider,{value:{logs:r,log:a,clearLogs:o},children:s})},ue=({children:s})=>{const[t,r]=x.useState({});return e.jsx($.Provider,{value:{files:t,setFiles:r},children:s})};P.createRoot(document.getElementById("root")).render(e.jsx(x.StrictMode,{children:e.jsx(de,{children:e.jsx(ue,{children:e.jsx(ie,{})})})}));
