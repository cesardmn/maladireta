import{D as w}from"./docxtemplater-N1i14-OG.js";import{P as S}from"./pizzip-YOn4fNJJ.js";import{r as b,u as L}from"./xlsx-B4JKliiB.js";import{J as q}from"./jszip-CuQb68Cf.js";import{F as T}from"./file-saver-BPLbHmtI.js";import"./@xmldom-DOVMbaKB.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function d(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(e){if(e.ep)return;e.ep=!0;const o=d(e);fetch(e.href,o)}})();const y=(()=>{const r=async n=>{if(!n)return;const e=await n.arrayBuffer(),o=new S(e);return new w(o)};return{replaceTags:async(n,e)=>{const o=await r(n);return o.render(e),o.getZip().generate({type:"blob",mimeType:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})},getTags:async n=>{const o=(await r(n)).getFullText(),a=/{([^}]+)}/g,f=[...o.matchAll(a)];return[...new Set(f.map(m=>m[1]))]}}})(),C={readerXLSX:async l=>{try{const d=await l.arrayBuffer(),n=b(d,{type:"array"}),e=n.SheetNames[0],o=n.Sheets[e],a=L.sheet_to_json(o,{defval:""}),f=a.length>0?Object.keys(a[0]):[];return{status:"ok",data:a,headers:f}}catch(d){return{status:"nok",error:d}}}};(()=>{(()=>{const t=new Date().getFullYear(),s=document.querySelector("footer");s.innerText=`© autoflux ${t} - Cesar Dimi`})();const r={docx:{file:null,tags:[]},xlsx:{file:null,tags:[]}},l=document.querySelector("#docxInput"),d=document.querySelector("#xlsxInput"),n=document.querySelector(".docx-error"),e=document.querySelector(".xslx-error"),o=document.querySelector(".preview-log"),a=document.querySelector("#generate"),f=(t,s)=>{if(!t||!t.name)return!1;const i=t.name.toLowerCase(),c=s.toLowerCase();return i.endsWith(c)},p=(t,s)=>{const i=new Set,c=new Set;t.forEach(x=>{s.includes(x)?i.add(x):c.add(x)});const u=[...i],g=[...c];return{isValid:g.length===0&&u.length>0,matchedTags:u,unmatchedTags:g}},m=()=>{n.textContent="";const t=document.querySelector(".step.active-step");if(!t)return;let s=t.nextElementSibling;for(;s&&!s.classList.contains("step");)s=s.nextElementSibling;s&&(t.classList.remove("active-step"),s.classList.add("active-step"))},h=()=>{const t=p(r.docx.tags,r.xlsx.tags);!t.isValid&&t.matchedTags.length===0?o.textContent="Não há tags no documento modelo.":!t.isValid&&t.unmatchedTags.length>0?o.textContent="Há tags no documento modelo que não existem no arquivo de dados.":t.isValid&&(o.textContent=`Documentos importados com sucesso.
 clique abaixo para gerar os arquivos.`)};l.onchange=async t=>{n.textContent="",n.classList.remove("danger");const s=t.target.files[0];if(!f(s,".docx")){n.textContent="Arquivo inexistente ou inválido.",n.classList.add("danger");return}const c=await y.getTags(s);if(c.length<=0){n.textContent="Arquivo não possui tags.",n.classList.add("danger");return}r.docx.tags=c,r.docx.file=s,m(),t.target.value=""};const v=async()=>{const t=new q;for(const i of r.xlsx.data){const c=await y.replaceTags(r.docx.file,i),u=Object.keys(i)[0],g=`${u}_${i[u]}.docx`;t.file(g,c)}const s=await t.generateAsync({type:"blob"});T.saveAs(s,"documentos.zip")};d.onchange=async t=>{e.textContent="",e.classList.remove("danger");const s=t.target.files[0];if(!f(s,".xlsx")){e.textContent="Arquivo inexistente ou inválido.",e.classList.add("danger");return}const{data:c,headers:u}=await C.readerXLSX(s);if(u.length==0){e.textContent="Arquivo não possui dados.",e.classList.add("danger");return}r.xlsx.tags=u,r.xlsx.file=s,r.xlsx.data=c,m(),t.target.value="",h()},a.onclick=()=>{v()}})();
